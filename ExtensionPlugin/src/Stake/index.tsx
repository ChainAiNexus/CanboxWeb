import { useEffect, useRef, useState } from "react";
import TabIndex from "../components/tabIndex";
import Header from "../components/header";
import icon1 from "../assets/image/icon1.png";
import icon2 from "../assets/image/icon2.png";
import icon3 from "../assets/image/icon3.png";
import icon4 from "../assets/image/icon4.png";
import { ToastContainer, toast } from "react-toastify";
import { useNavigate } from "react-router-dom";
import { indxApi } from "../api";

function App() {
  const navigate = useNavigate();

  // 
  const [webMes, setWebMes]: any = useState(localStorage.getItem("webMes") ? JSON.parse(localStorage.getItem("webMes") ?? "") : "");
  const [webMes2, setWebMes2]: any = useState(localStorage.getItem("webMes2") ? JSON.parse(localStorage.getItem("webMes2") ?? "") : "");
  useEffect(() => {
    chrome?.runtime?.onMessageExternal?.addListener(
      async (request, sender, sendResponse) => {
        // 
        if (request.event === "pledgeRecord") {
          setWebMes(request?.data);
          console.log(request?.data);
          localStorage.setItem("webMes", JSON.stringify(request?.data));
        }
        if (request.event === "balance") {
          setWebMes2(request?.data);
          console.log(request?.data);
          localStorage.setItem("webMes2", JSON.stringify(request?.data));
        }
        sendResponse("ok");
      }
    );
    return () => {
      setWebMes("");
      setWebMes2("");
    }
  }, []);



  return (
    <div className="pt-[80px]">
      <Header />
      <ToastContainer />

      <div className=" px-20">
        <div
          className="flex w-full h-[48px] py-4 justify-center items-center"
          style={{
            background:
              "linear-gradient(90deg, rgba(155, 110, 75, 0.00) -2.13%, #B98961 52.77%, rgba(155, 110, 75, 0.00) 100%)",
          }}
        >
          <img src={icon2} className="w-[20px] h-[40px]" alt="" />
          <div className="flex items-center justify-center flex-1 ">
            <svg
              className="mr-[10px] ml-10"
              xmlns="http://www.w3.org/2000/svg"
              width="31"
              height="24"
              viewBox="0 0 31 24"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M5.93231 1.57275C4.76656 1.57275 4.13814 2.28915 4.13814 3.4549C4.13814 3.65183 4.16511 3.84245 4.21555 4.02329C4.37238 4.5855 4.69929 5.12415 5.02618 5.66277C5.47927 6.40932 5.93231 7.1558 5.93231 7.96479V15.7039C5.93231 16.5278 5.46182 17.2888 4.99133 18.0497C4.75389 18.4337 4.51646 18.8178 4.3395 19.2099C4.14424 19.5298 4.03174 19.9057 4.03174 20.308C4.03174 21.4737 4.97677 22.4188 6.14252 22.4188C6.14874 22.4188 6.15495 22.4187 6.16116 22.4187C6.16667 22.4187 6.17218 22.4187 6.1777 22.4187C7.34345 22.4187 8.32453 21.203 8.32453 20.4643C8.32453 19.8263 8.45221 19.337 9.01054 18.8982L20.2447 9.57134C20.727 9.19228 21.4257 9.10305 22.0446 9.22435C23.3287 9.54096 24.3623 8.87848 24.6479 7.64126C24.9102 6.50538 24.3795 5.5627 23.2436 5.30046C23.0577 5.25755 22.872 5.24063 22.69 5.2473C22.6774 5.24738 22.6648 5.24757 22.6522 5.24787C22.0038 5.26349 21.3318 5.50258 20.6597 5.74171C19.7772 6.05567 18.8945 6.36971 18.0648 6.17816L11.0615 4.56132C10.2186 4.36672 9.55252 3.67719 8.88666 2.98791C8.1781 2.25441 7.03559 1.57275 5.93231 1.57275ZM20.1801 7.85234C19.969 7.02561 18.966 6.74726 18.1633 6.56194L10.6225 4.82101C9.81133 4.63374 8.37126 4.87076 7.65144 5.35482C6.93336 5.83771 6.28411 7.53309 6.28411 8.33417L6.1777 15.7039C6.1777 16.9991 6.77662 17.7635 7.11083 18.0497C7.44504 18.3359 8.5532 18.8982 9.01054 18.5118L19.6614 9.58239C20.0606 9.26861 20.3912 8.67906 20.1801 7.85234Z"
                fill="white"
                fill-opacity="0.69"
              />
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M16.4675 0.729077C16.1706 0.0957928 15.4164 -0.176851 14.7832 0.120109C14.4537 0.274604 14.2431 0.587767 13.9976 0.845121C13.6437 1.21593 13.2854 1.59145 12.8168 1.68834L9.22755 2.43051C8.64225 2.55153 8.07191 2.24695 7.56997 1.89721C7.43535 1.7781 7.28817 1.67866 7.13258 1.59939C6.96161 1.50403 6.7744 1.43105 6.57394 1.38521C5.43753 1.1253 4.30559 1.83586 4.04569 2.97227C3.90013 3.6087 4.05895 4.24374 4.4265 4.72498C4.67966 5.35196 4.86997 6.04385 4.57473 6.62112L2.99131 9.71705C2.78054 10.1292 2.3455 10.3668 1.91453 10.6023C1.70515 10.7167 1.49673 10.8305 1.31546 10.9636C1.30303 10.9727 1.2907 10.9821 1.27851 10.9918C0.999323 11.2127 0.838179 11.5275 0.804459 11.8557C0.798805 11.9042 0.795898 11.9536 0.795898 12.0037C0.795898 12.4093 0.99272 12.7613 1.285 12.9901C1.46847 13.1337 1.6824 13.2584 1.89766 13.3838C2.3364 13.6395 2.78067 13.8984 2.98376 14.3278L4.47415 17.4785C4.76979 18.1035 4.50734 18.8426 4.23603 19.4785C4.12762 19.7327 4.06761 20.0124 4.06761 20.3061C4.06761 21.4719 5.01264 22.4169 6.1784 22.4169C6.61429 22.4169 7.01934 22.2848 7.35565 22.0584L7.35687 22.0576C7.91626 21.6811 8.57291 21.2992 9.22788 21.4589L12.9032 22.355C13.3563 22.4655 13.6932 22.8368 14.0262 23.2038C14.1508 23.3411 14.2748 23.4778 14.4041 23.6C14.4946 23.6951 14.5997 23.7761 14.7157 23.8394C14.8967 23.9413 15.1046 24 15.3251 24C16.0246 24 16.5916 23.433 16.5916 22.7335C16.5916 22.2618 16.3337 21.8504 15.9513 21.6324C15.7995 21.5283 15.6339 21.4324 15.4675 21.336L15.4673 21.3359C15.0178 21.0755 14.5624 20.8118 14.3583 20.3735L11.808 14.8971C11.3125 13.8332 12.3754 13.1844 12.4467 12.1856C12.6053 11.0305 11.2872 10.1661 11.872 8.97515L14.4297 3.76577C14.7035 3.20821 15.1186 2.68849 15.7297 2.61072C16.3408 2.53295 16.8229 2.73049 17.1439 3.00285L19.9387 5.37407C20.4606 5.81685 20.5307 6.58782 20.5496 7.27197C20.5574 7.55326 20.6219 7.83758 20.749 8.10862C21.2439 9.16409 22.5008 9.6185 23.5563 9.12357C24.6117 8.62863 25.0661 7.37178 24.5712 6.31631C24.1411 5.39904 23.1455 4.99124 22.2448 5.15879C21.4785 5.30134 20.5623 5.44223 19.968 4.93793L17.3165 2.68812C16.9636 2.38864 16.8317 1.91076 16.7012 1.43735C16.6353 1.19877 16.573 0.953998 16.4675 0.729077ZM12.9585 2.01812C13.3702 1.93303 13.9658 1.89234 14.1978 2.25153C14.4297 2.61072 14.3173 3.19633 14.1206 3.59693L11.4817 8.97094C11.2283 9.48711 10.6731 9.75017 10.108 9.92819C9.70091 9.97449 9.33014 10.136 9.02806 10.3788C8.29477 10.9233 7.90146 11.9684 6.82432 11.9403L4.61691 11.8828C4.11397 11.8697 3.41679 11.5112 3.24959 11.2186C3.0824 10.9261 3.12549 10.227 3.33718 9.81306L5.00599 6.5498C5.31761 5.94044 6.05209 5.69584 6.71376 5.52085C6.9858 5.44891 7.24782 5.32107 7.48259 5.13532C7.89134 4.81193 8.10845 4.26211 8.24279 3.89375C8.37713 3.52539 8.96542 2.8436 9.55319 2.7221L12.9585 2.01812ZM8.90157 13.6677C9.66898 14.4312 11.1235 14.2582 11.6236 15.3323L14.093 20.6361C14.2579 20.9904 14.3583 21.4671 14.1667 21.8023C13.9751 22.1375 13.3274 22.0963 12.9195 21.9968L9.61454 21.1911C8.90706 21.0186 8.48917 20.2893 8.16942 19.6146C8.07561 19.3539 7.93072 19.1195 7.74925 18.92C7.42325 18.5473 6.97081 18.2837 6.45354 18.2138C5.75502 18.0294 4.99847 17.7642 4.69768 17.1283L3.28683 14.1457C3.10219 13.7554 3.04028 13.2558 3.22854 12.8496C3.41679 12.4435 4.1524 12.2226 4.66644 12.2359L7.06096 12.2982C7.99227 12.3225 8.32108 13.1624 8.90157 13.6677Z"
                fill="white"
              />
              <path
                d="M29.7637 14.1494H30.6895V17.7499H29.4293L26.9759 15.0495V17.7499H26.05V14.1494H27.3051L29.7637 16.8549V14.1494Z"
                fill="white"
              />
              <path
                d="M24.8052 17.7499L24.4194 16.9835H22.2643L21.8785 17.7499H20.8601L22.7169 14.1494H23.9668L25.8287 17.7499H24.8052ZM22.6089 16.2943H24.0748L23.3444 14.8335L22.6089 16.2943Z"
                fill="white"
              />
              <path
                d="M16.6206 15.9442C16.6206 14.7509 17.2995 14.0977 18.8838 14.0977C20.3188 14.0977 21.0389 14.6429 21.1315 15.6819H20.1902C20.1028 15.1006 19.6553 14.8743 18.8838 14.8743C17.9425 14.8743 17.5464 15.2087 17.5464 15.9442C17.5464 16.6848 17.9476 17.0243 18.8838 17.0243C19.6501 17.0243 20.1028 16.7929 20.1902 16.2065H21.1315C21.0389 17.2506 20.3188 17.801 18.8838 17.801C17.2995 17.801 16.6206 17.1426 16.6206 15.9442Z"
                fill="white"
              />
            </svg>
            <div className="text-[#fff] text-[16px] font-[300]">Balance</div>
            <div className="text-[#fff] text-[16px] flex-1 text-right pr-[20px]">
              {webMes2?.balance}
            </div>
          </div>
          <img src={icon3} className="w-[20px] h-[40px]" alt="" />
        </div>
      </div>

      <div className="">
        <img
          src={icon1}
          className="w-[140px] h-[140px] mx-auto mt-[38px] mb-[8px]"
          alt=""
        />
        <img
          src={icon4}
          className="h-[24px] mx-auto mt-[0px] mb-[24px]"
          alt=""
        />
      </div>

      <div onClick={() => {
        navigate('/stake/details')
      }} className="relative h-[30px] rounded-[20px] p-4 mx-20 bg-[#225150] px-10 py-[20px] flex items-center">
        <div className="text-[#fff] text-[16px]">Total staking</div>
        <div className="text-[#3DFFFF] text-[16px] ml-8">{webMes?.total}</div>
        <div
          className="text-[#fff] text-[14px] flex-1 text-right mr-6 cursor-pointer"

        >
          Details
        </div>
        <svg
          className=" cursor-pointer"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
        >
          <path
            d="M16.175 13H4V11H16.175L10.575 5.4L12 4L20 12L12 20L10.575 18.6L16.175 13Z"
            fill="white"
          />
        </svg>
      </div>

      <div className="flex items-center mx-[20px] mt-[50px]">
        <div
          className="flex-1 mr-10 rounded-[20px] px-8 py-10 flex items-center"
          style={{ border: "1px solid #fff" }}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="31"
            height="24"
            viewBox="0 0 31 24"
            fill="none"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M5.93231 1.57275C4.76656 1.57275 4.13814 2.28915 4.13814 3.4549C4.13814 3.65183 4.16511 3.84245 4.21555 4.02329C4.37238 4.5855 4.69929 5.12415 5.02618 5.66277C5.47927 6.40932 5.93231 7.1558 5.93231 7.96479V15.7039C5.93231 16.5278 5.46182 17.2888 4.99133 18.0497C4.75389 18.4337 4.51646 18.8178 4.3395 19.2099C4.14424 19.5298 4.03174 19.9057 4.03174 20.308C4.03174 21.4737 4.97677 22.4188 6.14252 22.4188C6.14874 22.4188 6.15495 22.4187 6.16116 22.4187C6.16667 22.4187 6.17218 22.4187 6.1777 22.4187C7.34345 22.4187 8.32453 21.203 8.32453 20.4643C8.32453 19.8263 8.45221 19.337 9.01054 18.8982L20.2447 9.57134C20.727 9.19228 21.4257 9.10305 22.0446 9.22435C23.3287 9.54096 24.3623 8.87848 24.6479 7.64126C24.9102 6.50538 24.3795 5.5627 23.2436 5.30046C23.0577 5.25755 22.872 5.24063 22.69 5.2473C22.6774 5.24738 22.6648 5.24757 22.6522 5.24787C22.0038 5.26349 21.3318 5.50258 20.6597 5.74171C19.7772 6.05567 18.8945 6.36971 18.0648 6.17816L11.0615 4.56132C10.2186 4.36672 9.55252 3.67719 8.88666 2.98791C8.1781 2.25441 7.03559 1.57275 5.93231 1.57275ZM20.1801 7.85234C19.969 7.02561 18.966 6.74726 18.1633 6.56194L10.6225 4.82101C9.81133 4.63374 8.37126 4.87076 7.65144 5.35482C6.93336 5.83771 6.28411 7.53309 6.28411 8.33417L6.1777 15.7039C6.1777 16.9991 6.77662 17.7635 7.11083 18.0497C7.44504 18.3359 8.5532 18.8982 9.01054 18.5118L19.6614 9.58239C20.0606 9.26861 20.3912 8.67906 20.1801 7.85234Z"
              fill="white"
              fill-opacity="0.69"
            />
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M16.4675 0.729077C16.1706 0.0957928 15.4164 -0.176851 14.7832 0.120109C14.4537 0.274604 14.2431 0.587767 13.9976 0.845121C13.6437 1.21593 13.2854 1.59145 12.8168 1.68834L9.22755 2.43051C8.64225 2.55153 8.07191 2.24695 7.56997 1.89721C7.43535 1.7781 7.28817 1.67866 7.13258 1.59939C6.96161 1.50403 6.7744 1.43105 6.57394 1.38521C5.43753 1.1253 4.30559 1.83586 4.04569 2.97227C3.90013 3.6087 4.05895 4.24374 4.4265 4.72498C4.67966 5.35196 4.86997 6.04385 4.57473 6.62112L2.99131 9.71705C2.78054 10.1292 2.3455 10.3668 1.91453 10.6023C1.70515 10.7167 1.49673 10.8305 1.31546 10.9636C1.30303 10.9727 1.2907 10.9821 1.27851 10.9918C0.999323 11.2127 0.838179 11.5275 0.804459 11.8557C0.798805 11.9042 0.795898 11.9536 0.795898 12.0037C0.795898 12.4093 0.99272 12.7613 1.285 12.9901C1.46847 13.1337 1.6824 13.2584 1.89766 13.3838C2.3364 13.6395 2.78067 13.8984 2.98376 14.3278L4.47415 17.4785C4.76979 18.1035 4.50734 18.8426 4.23603 19.4785C4.12762 19.7327 4.06761 20.0124 4.06761 20.3061C4.06761 21.4719 5.01264 22.4169 6.1784 22.4169C6.61429 22.4169 7.01934 22.2848 7.35565 22.0584L7.35687 22.0576C7.91626 21.6811 8.57291 21.2992 9.22788 21.4589L12.9032 22.355C13.3563 22.4655 13.6932 22.8368 14.0262 23.2038C14.1508 23.3411 14.2748 23.4778 14.4041 23.6C14.4946 23.6951 14.5997 23.7761 14.7157 23.8394C14.8967 23.9413 15.1046 24 15.3251 24C16.0246 24 16.5916 23.433 16.5916 22.7335C16.5916 22.2618 16.3337 21.8504 15.9513 21.6324C15.7995 21.5283 15.6339 21.4324 15.4675 21.336L15.4673 21.3359C15.0178 21.0755 14.5624 20.8118 14.3583 20.3735L11.808 14.8971C11.3125 13.8332 12.3754 13.1844 12.4467 12.1856C12.6053 11.0305 11.2872 10.1661 11.872 8.97515L14.4297 3.76577C14.7035 3.20821 15.1186 2.68849 15.7297 2.61072C16.3408 2.53295 16.8229 2.73049 17.1439 3.00285L19.9387 5.37407C20.4606 5.81685 20.5307 6.58782 20.5496 7.27197C20.5574 7.55326 20.6219 7.83758 20.749 8.10862C21.2439 9.16409 22.5008 9.6185 23.5563 9.12357C24.6117 8.62863 25.0661 7.37178 24.5712 6.31631C24.1411 5.39904 23.1455 4.99124 22.2448 5.15879C21.4785 5.30134 20.5623 5.44223 19.968 4.93793L17.3165 2.68812C16.9636 2.38864 16.8317 1.91076 16.7012 1.43735C16.6353 1.19877 16.573 0.953998 16.4675 0.729077ZM12.9585 2.01812C13.3702 1.93303 13.9658 1.89234 14.1978 2.25153C14.4297 2.61072 14.3173 3.19633 14.1206 3.59693L11.4817 8.97094C11.2283 9.48711 10.6731 9.75017 10.108 9.92819C9.70091 9.97449 9.33014 10.136 9.02806 10.3788C8.29477 10.9233 7.90146 11.9684 6.82432 11.9403L4.61691 11.8828C4.11397 11.8697 3.41679 11.5112 3.24959 11.2186C3.0824 10.9261 3.12549 10.227 3.33718 9.81306L5.00599 6.5498C5.31761 5.94044 6.05209 5.69584 6.71376 5.52085C6.9858 5.44891 7.24782 5.32107 7.48259 5.13532C7.89134 4.81193 8.10845 4.26211 8.24279 3.89375C8.37713 3.52539 8.96542 2.8436 9.55319 2.7221L12.9585 2.01812ZM8.90157 13.6677C9.66898 14.4312 11.1235 14.2582 11.6236 15.3323L14.093 20.6361C14.2579 20.9904 14.3583 21.4671 14.1667 21.8023C13.9751 22.1375 13.3274 22.0963 12.9195 21.9968L9.61454 21.1911C8.90706 21.0186 8.48917 20.2893 8.16942 19.6146C8.07561 19.3539 7.93072 19.1195 7.74925 18.92C7.42325 18.5473 6.97081 18.2837 6.45354 18.2138C5.75502 18.0294 4.99847 17.7642 4.69768 17.1283L3.28683 14.1457C3.10219 13.7554 3.04028 13.2558 3.22854 12.8496C3.41679 12.4435 4.1524 12.2226 4.66644 12.2359L7.06096 12.2982C7.99227 12.3225 8.32108 13.1624 8.90157 13.6677Z"
              fill="white"
            />
            <path
              d="M29.7637 14.1494H30.6895V17.7499H29.4293L26.9759 15.0495V17.7499H26.05V14.1494H27.3051L29.7637 16.8549V14.1494Z"
              fill="white"
            />
            <path
              d="M24.8052 17.7499L24.4194 16.9835H22.2643L21.8785 17.7499H20.8601L22.7169 14.1494H23.9668L25.8287 17.7499H24.8052ZM22.6089 16.2943H24.0748L23.3444 14.8335L22.6089 16.2943Z"
              fill="white"
            />
            <path
              d="M16.6206 15.9442C16.6206 14.7509 17.2995 14.0977 18.8838 14.0977C20.3188 14.0977 21.0389 14.6429 21.1315 15.6819H20.1902C20.1028 15.1006 19.6553 14.8743 18.8838 14.8743C17.9425 14.8743 17.5464 15.2087 17.5464 15.9442C17.5464 16.6848 17.9476 17.0243 18.8838 17.0243C19.6501 17.0243 20.1028 16.7929 20.1902 16.2065H21.1315C21.0389 17.2506 20.3188 17.801 18.8838 17.801C17.2995 17.801 16.6206 17.1426 16.6206 15.9442Z"
              fill="white"
            />
          </svg>
          <input
            type="number"
            className="w-full pl-8 text-[#fff]"
            style={{ background: "none" }}
            placeholder="Amount"
          />
        </div>
        <div
          className="text-[#000] text-[16px] bg-[#fff] py-8 px-18 rounded-[20px] cursor-pointer"
          onClick={() => {
            toast("Please go to the PC end to pledge.", {
              toastId: "custom-toast",
              hideProgressBar: true,
              autoClose: 2000,
              className: "custom-toast",
              style: {
                backgroundColor: "#104243", // 
                color: "#ffffff", // 
                fontSize: "16px",
              },
            });
          }}
        >
          Stake
        </div>
      </div>

      <TabIndex index={2} />
    </div>
  );
}

export default App;
